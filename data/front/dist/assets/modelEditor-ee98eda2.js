import{af as e,ag as t,ah as n,ai as a,aj as o,ak as i,al as c,am as s,an as r,d as p,u as l,e as d,g as m,a6 as u,o as b,c as v,a as g,G as h,ao as f,z as y,J as E,K as _,_ as x}from"./index-4bfb878d.js";import{g as k,u as C,c as w}from"./index-c4ec4324.js";function T(e){return e.originalEvent||e.srcEvent}function D(e){return function(e,t){return(T(e)||e).button===t}(e,0)}function P(e){var t=T(e)||e;return!!D(e)&&(/mac/i.test(navigator.platform)?t.metaKey:t.ctrlKey)}function S(e,t,n,a,o,i,c,s,r,p,l,d){e=e||{},a.registerProvider(this),this._contextPad=a,this._modeling=o,this._elementFactory=i,this._connect=c,this._create=s,this._popupMenu=r,this._canvas=p,this._rules=l,this._translate=d,!1!==e.autoPlace&&(this._autoPlace=t.get("autoPlace",!1)),n.on("create.end",250,(function(e){const t=e.context.shape;if(!P(e)||!a.isOpen(t))return;const n=a.getEntries(t);n.replace&&n.replace.action.click(e,t)}))}function A(e,t,n){const a=e.$instanceOf(t);let o=!1;const c=e.eventDefinitions||[];return i(c,(function(e){e.$type===n&&(o=!0)})),a&&o}S.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"],S.prototype.getContextPadEntries=function(i){const r=this._contextPad,p=this._modeling,l=this._elementFactory,d=this._connect,m=this._create,u=this._popupMenu,b=this._canvas,v=this._rules,g=this._autoPlace,h=this._translate,f={};if("label"===i.type)return f;const y=i.businessObject;function E(e,t){d.start(e,t)}function _(e,t,a,o){function i(t,a){const i=l.createShape(n({type:e},o));m.start(t,i,{source:a})}"string"!=typeof a&&(o=a,a=h("Append {type}",{type:e.replace(/^bpmn:/,"")}));return{group:"model",className:t,title:a,action:{dragstart:i,click:g?function(t,a){const i=l.createShape(n({type:e},o));g.append(a,i)}:i}}}function x(e){return function(t,n){p.splitLane(n,e),r.open(n,!0)}}if(e(y,["bpmn:Lane","bpmn:Participant"])&&c(y)){const e=s(i);n(f,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:h("Add Lane above"),action:{click:function(e,t){p.addLane(t,"top")}}}}),e.length<2&&(i.height>=120&&n(f,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:h("Divide into two Lanes"),action:{click:x(2)}}}),i.height>=180&&n(f,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:h("Divide into three Lanes"),action:{click:x(3)}}})),n(f,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:h("Add Lane below"),action:{click:function(e,t){p.addLane(t,"bottom")}}}})}t(y,"bpmn:FlowNode")&&(t(y,"bpmn:EventBasedGateway")?n(f,{"append.receive-task":_("bpmn:ReceiveTask","bpmn-icon-receive-task",h("Append ReceiveTask")),"append.message-intermediate-event":_("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",h("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":_("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",h("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":_("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",h("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":_("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",h("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):A(y,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?n(f,{"append.compensation-activity":_("bpmn:Task","bpmn-icon-task",h("Append compensation activity"),{isForCompensation:!0})}):t(y,"bpmn:EndEvent")||y.isForCompensation||A(y,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||a(y)||n(f,{"append.end-event":_("bpmn:EndEvent","bpmn-icon-end-event-none",h("Append EndEvent")),"append.gateway":_("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",h("Append Gateway")),"append.append-task":_("bpmn:UserTask","bpmn-icon-user-task",h("Append Task")),"append.intermediate-event":_("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",h("Append Intermediate/Boundary Event"))})),u.isEmpty(i,"bpmn-replace")||n(f,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"修改类型",action:{click:function(e,t){const a=n(function(e){const t=b.getContainer(),n=r.getPad(e).html,a=t.getBoundingClientRect(),o=n.getBoundingClientRect(),i=o.top-a.top;return{x:o.left-a.left,y:i+o.height+5}}(t),{cursor:{x:e.x,y:e.y}});u.open(t,"bpmn-replace",a)}}}}),e(y,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&n(f,{"append.text-annotation":_("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:h("Connect using "+(y.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:E,dragstart:E}}}),e(y,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&n(f,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:h("Connect using DataInputAssociation"),action:{click:E,dragstart:E}}}),t(y,"bpmn:Group")&&n(f,{"append.text-annotation":_("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let k=v.allowed("elements.delete",{elements:[i]});return o(k)&&(k=k[0]===i),k&&n(f,{delete:{group:"edit",className:"bpmn-icon-trash",title:h("Remove"),action:{click:function(){p.removeElements([i])}}}}),f};const N={__init__:["contextPadProvider"],contextPadProvider:["type",S]};function I(e,t,n,a,o,i,c,s){r.call(this,e,t,n,a,o,i,c,s,2e3)}const j=function(){};(j.prototype=r.prototype).getPaletteEntries=function(){const e={},t=this._create,a=this._elementFactory,o=this._spaceTool,i=this._lassoTool,c=this._handTool,s=this._globalConnect,r=this._translate;function p(e,o,i,c,s){function p(o){const i=a.createShape(n({type:e},s));s&&(i.businessObject.di.isExpanded=s.isExpanded),t.start(o,i)}const l=e.replace(/^bpmn:/,"");return{group:o,className:i,title:c||r("Create {type}",{type:l}),action:{dragstart:p,click:p}}}function l(e){const n=a.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),o=a.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:n});t.start(e,[n,o],{hints:{autoSelect:[o]}})}function d(e){t.start(e,a.createParticipantShape())}return n(e,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"激活抓手工具",action:{click:function(e){c.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:r("Activate the lasso tool"),action:{click:function(e){i.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:r("Activate the create/remove space tool"),action:{click:function(e){o.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:r("Activate the global connect tool"),action:{click:function(e){s.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":p("bpmn:StartEvent","event","bpmn-icon-start-event-none",r("Create StartEvent")),"create.intermediate-event":p("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",r("Create Intermediate/Boundary Event")),"create.end-event":p("bpmn:EndEvent","event","bpmn-icon-end-event-none",r("Create EndEvent")),"create.exclusive-gateway":p("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",r("Create Gateway")),"create.user-task":p("bpmn:UserTask","activity","bpmn-icon-user-task",r("Create User Task")),"create.data-object":p("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",r("Create DataObjectReference")),"create.data-store":p("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",r("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:r("Create expanded SubProcess"),action:{dragstart:l,click:l}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:r("Create Pool/Participant"),action:{dragstart:d,click:d}},"create.group":p("bpmn:Group","artifact","bpmn-icon-group",r("Create Group"))}),e},I.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],I.prototype=new j,I.prototype.constructor=I;const R={__init__:["paletteProvider"],paletteProvider:["type",I]},M={class:"app-container"},F=x(p({__name:"modelEditor",setup(e){const t=l(),n=_(),a=d(void 0),o=d(null),i=d(0),c=d({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[N,R]}),s=d();m((()=>{const e=t.currentRoute.value.query&&t.currentRoute.value.query.modelId;console.log(e,"modelId"),e&&k(e).then((e=>{console.log(e,"response"),a.value=e.bpmnXml,s.value={...e,bpmnXml:void 0}}))}));const r=e=>{setTimeout((()=>{o.value=e,console.log(e,"initModeler方法modeler"),console.log(o.value,"initModeler方法modeler")}),10)},p=e=>{const t={...s.value??{},bpmnXml:e};console.log(t,"data"),t.id?C(t).then((e=>{console.log(e,"response"),n.success("修改成功"),x()})):w(t).then((e=>{console.log(e,"response1"),n.success("保存成功"),x()}))},x=()=>{t.push({path:"/bpm/manager/model"})};return(e,t)=>{const n=u("my-process-designer"),l=u("my-properties-panel");return b(),v("div",M,[void 0!==g(a)?(b(),h(n,f({key:`designer-${g(i)}`,modelValue:g(a),"onUpdate:modelValue":t[0]||(t[0]=e=>y(a)?a.value=e:null),value:g(a)},g(c),{keyboard:"",ref:"processDesigner",onInitFinished:r,additionalModel:g(c).additionalModel,onSave:p}),null,16,["modelValue","value","additionalModel"])):E("",!0),(b(),h(l,{key:`penal-${g(i)}`,bpmnModeler:g(o),prefix:g(c).prefix,class:"process-panel",model:g(s)},null,8,["bpmnModeler","prefix","model"]))])}}}),[["__file","/Users/alex/Downloads/万界星空/产品研发/MES框架/dev/xiejinrun/new_open_mes_front/src/views/bpm/model/modelEditor.vue"]]);export{F as default};
